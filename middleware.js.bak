import { isBot } from 'is-bot';

export const config = {
    matcher: ['/((?!_next/static|_next/image|favicon.ico|static/|assets/|.*\\.(?:svg|png|jpg|jpeg|gif|webp|woff2|js|css|json|xml|txt|ico)$).*)'],
};

export default function middleware(request) {
    try {
        const url = new URL(request.url);
        const userAgent = request.headers.get('user-agent') || '';
        const isBotRequest = isBot(userAgent);

        if (isBotRequest) {
            console.log('Bot detected:', userAgent);
            const botUrl = new URL(request.url);
            botUrl.pathname = `/render-bot${botUrl.pathname}`;
            return Response.rewrite(botUrl);
        }

        // Явно возвращаем undefined вместо просто return;
        return undefined;
    } catch (error) {
        console.error('Middleware error:', error);
        // Явно возвращаем undefined
        return undefined;
    }
}
